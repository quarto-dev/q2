---
title: "JSON Output Format"
---

The `quarto-markdown-pandoc` binary can output AST in JSON format using `-t json`. This format is designed to be compatible with Pandoc's JSON AST while adding source tracking information.

## Basic Structure

The JSON output contains three main sections:

```json
{
  "pandoc-api-version": [1, 23, 1],
  "meta": { /* metadata */ },
  "blocks": [ /* block elements */ ],
  "astContext": {
    "files": [ /* array of source file information */ ],
    "sourceInfoPool": [ /* source location data */ ]
  }
}
```

## Source Information Tracking

Unlike Pandoc, `quarto-markdown-pandoc` tracks the exact source location of every AST node. This information is encoded compactly using a pool-and-reference system.

### How It Works

1. **Pool**: All unique source location information is stored once in `astContext.sourceInfoPool`
2. **References**: Each AST node has an `"s"` field containing a numeric index into the pool
3. **Deduplication**: Shared source information (e.g., siblings in YAML) reuses the same pool entry

### Example

```json
{
  "astContext": {
    "files": [
      {
        "name": "example.qmd",
        "line_breaks": [11],
        "total_length": 11
      }
    ],
    "sourceInfoPool": [
      {"r": [0, 5], "t": 0, "d": 0}
    ]
  },
  "blocks": [
    {
      "t": "Para",
      "s": 0,
      "c": [
        {"t": "Str", "c": "Hello", "s": 0}
      ]
    }
  ]
}
```

The `"s": 0` field means "look up source info at index 0 in the pool".

## SourceInfoPool Encoding

Each entry in the `sourceInfoPool` array has this compact format:

```json
{"r": [start_offset, end_offset], "t": type, "d": data}
```

### Fields

- **`r`** (range): 2-element array `[start_offset, end_offset]`
  - Byte offsets from the start of the relevant source
  - For Original: absolute offsets in the source file
  - For Substring: relative offsets within the parent source
  - Row and column information is computed on-demand from the file's line break index

- **`t`** (type): Integer indicating the source mapping type
  - `0` = Original (direct position in source file)
  - `1` = Substring (extracted from a parent source)
  - `2` = Concat (multiple sources joined together)

- **`d`** (data): Type-specific data (see below)

### Type 0: Original

Represents text directly from a source file.

```json
{"r": [0, 5], "t": 0, "d": 0}
```

- **`d`**: The file ID (index into `astContext.filenames`)

**Example**: The word "Hello" at bytes 0-5 in the first file (file_id=0).

### Type 1: Substring

Represents a substring extracted from another source.

```json
{"r": [4, 17], "t": 1, "d": 3}
```

- **`d`**: Index of the parent source in the pool
- **`r`**: `[start_offset, end_offset]` within the parent source (relative offsets)

**Example**: A 13-byte substring from bytes 4-17 of source #3 (e.g., extracting YAML value from frontmatter).

### Type 2: Concat

Represents multiple sources concatenated together.

```json
{"r": [0, 10], "t": 2, "d": [[1, 0, 5], [2, 5, 5]]}
```

- **`d`**: Array of pieces, where each piece is `[source_info_id, offset_in_concat, length]`
  - `source_info_id`: Index of this piece's source in the pool
  - `offset_in_concat`: Where this piece starts in the concatenated result (0-based)
  - `length`: Length of this piece in bytes
- **`r`**: `[0, total_length]` - the concatenated result spans from 0 to the sum of all piece lengths

**Example**: Joining sources #1 (5 bytes) and #2 (5 bytes) to create a 10-byte result.

## Complete Example

```json
{
  "pandoc-api-version": [1, 23, 1],
  "meta": {},
  "blocks": [
    {
      "t": "Para",
      "s": 3,
      "c": [
        {"t": "Str", "c": "Hello", "s": 0},
        {"t": "Space", "s": 1},
        {"t": "Str", "c": "world", "s": 2}
      ]
    }
  ],
  "astContext": {
    "files": [
      {
        "name": "example.qmd",
        "line_breaks": [],
        "total_length": 11
      }
    ],
    "sourceInfoPool": [
      {"r": [0, 5], "t": 0, "d": 0},
      {"r": [5, 6], "t": 0, "d": 0},
      {"r": [6, 11], "t": 0, "d": 0},
      {"r": [0, 11], "t": 2, "d": [[0, 0, 5], [1, 5, 1], [2, 6, 5]]}
    ]
  }
}
```

### Explanation

- Pool entry 0: "Hello" at bytes 0-5 (Original)
- Pool entry 1: Space at bytes 5-6 (Original)
- Pool entry 2: "world" at bytes 6-11 (Original)
- Pool entry 3: Concatenation of all three pieces (Concat)
- The Para block references entry 3 (the full concatenated range)
- Each inline element references its individual piece

## File Information

The `files` array in `astContext` contains information about each source file. Each entry has:

```json
{
  "name": "example.qmd",        // Source file path
  "line_breaks": [6, 13, 20],   // Byte offsets of each newline character
  "total_length": 25            // Total file size in bytes
}
```

The `line_breaks` and `total_length` fields allow JSON consumers to convert byte offsets to row/column positions without needing access to the original source files.

To convert a byte offset to (row, column):
1. Use binary search on `line_breaks` to find which line contains the offset
2. The row is the index where the offset would be inserted
3. The column is the offset minus the start of that line

This information is self-contained in the JSON, so consumers don't need to reopen source files

## Pandoc compatibility

For compatibility with tools expecting Pandoc JSON, either ignore the `"s"` fields and `astContext` section (that's what Pandoc will do) or remove them from the JSON object ahead of time.
